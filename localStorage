<script>
// âœ… Ø§Ø³ØªÙ…Ø¹ Ù„ØªØºÙŠÙŠØ±Ø§Øª localStorage Ù…Ù† Ø£ÙŠ Ù…ÙˆÙ‚Ø¹
window.addEventListener('storage', function(e) {
  // Ø¥Ø°Ø§ ØªØºÙŠØ±Øª Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª
  if (e.key === 'memoOrders' && e.newValue) {
    const orders = JSON.parse(e.newValue);
    const latestOrder = orders[orders.length - 1]; // Ø£Ø­Ø¯Ø« Ø·Ù„Ø¨
    showOrderAlert(latestOrder);
  }
});

// Ø¹Ø±Ø¶ ØªÙ†Ø¨ÙŠÙ‡ Ù„Ù„Ø·Ù„Ø¨
function showOrderAlert(order) {
  const container = document.getElementById("incoming-orders");
  
  // ØªØ¬Ù†Ø¨ Ø§Ù„ØªÙƒØ±Ø§Ø±
  if (document.querySelector(`[data-order-id="${order.id}"]`)) return;

  const alert = document.createElement("div");
  alert.className = "order-alert";
  alert.setAttribute("data-order-id", order.id);
  alert.innerHTML = `
    <strong>ğŸš¨ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù†: ${order.name}</strong><br>
    <strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${order.phone}<br>
    <strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${order.address}<br>
    <strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</strong> ${order.total} Ø¯Ø±Ù‡Ù…<br>
    <strong>Ø§Ù„ÙˆÙ‚Øª:</strong> ${order.timestamp}
  `;
  container.appendChild(alert);

  // ğŸ”Š ØµÙˆØª Ø¹Ù†Ø¯ Ø§Ù„Ø·Ù„Ø¨
  const audio = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-bell-ringing-933.mp3");
  audio.play().catch(e => console.log("ØªÙ… Ø±ÙØ¶ Ø§Ù„ØµÙˆØª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§"));

  // ğŸ’¬ Ø¥Ø´Ø¹Ø§Ø± Ù…ÙƒØªØ¨ÙŠ (Ø¥Ø°Ø§ Ù…ÙØ³Ù…ÙˆØ­)
  if (Notification.permission === "granted") {
    new Notification("Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ù…ÙŠÙ…Ùˆ Ø¥ÙƒØ³Ø¨Ø±ÙŠØ³!", {
      body: `Ø·Ù„Ø¨ Ù…Ù† ${order.name}ØŒ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${order.total} Ø¯Ø±Ù‡Ù…`,
      icon: "https://cdn-icons-png.flaticon.com/512/2936/2936888.png"
    });
  }
}

// Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
if (Notification.permission !== "denied") {
  Notification.requestPermission();
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­
window.onload = () => {
  const saved = localStorage.getItem("memoOrders");
  const container = document.getElementById("incoming-orders");

  if (saved) {
    const orders = JSON.parse(saved);
    if (orders.length > 0) {
      container.innerHTML = "<h3>Ø¢Ø®Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª:</h3>";
      const last = orders.slice(-5).reverse(); // Ø£Ø­Ø¯Ø« 5 Ø·Ù„Ø¨Ø§Øª
      last.forEach(order => {
        const alert = document.createElement("div");
        alert.className = "order-alert";
        alert.setAttribute("data-order-id", order.id);
        alert.innerHTML = `
          <strong>${order.name}</strong> - ${order.total} Ø¯Ø±Ù‡Ù…
          <small>${order.timestamp}</small>
        `;
        container.appendChild(alert);
      });
    }
  } else {
    container.innerHTML = "<p>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±... Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù‡Ù†Ø§.</p>";
  }
};
</script>
